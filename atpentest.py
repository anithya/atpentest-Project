#This is python3 tool, please do not use python2 you may face some issues.

import sys
import os
import requests
import re
import readline
#from input import input, keys 
#driver


#os.system('ls')
while(True):
	print("\n\n\t======================================================== \n")
	print("\t\tPENTEST AND ENUMERATION TOOL \n")
	print("\t======================================================== \n")
	print("\n")
	print("\t 1. Ping Sweep")
	print("\t 2. Reset Target IP address")
	print("\t 3. Port Scanning")
	print("\t 4. Only Vuln Scan")
	print("\t 5. URL Enum")
	print("\t 6. Useful Commands")
	print("\t 7. Exit\n\n")

	x = str(input("\t==> "))
	if(x=='1'):
		print("\n\n\t======== Ping Sweep ======== \n")
		print("\t Like : nmap -sn 192.168.137.1-254\n\n")
		os.system('nmap -sn 192.168.137.1-254')

		print("\n\n\t============================ \n")

		target_ip = input("\t==> Please enter the target IP address : ")

		while True:
			if re.search("[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}", str(target_ip)):
				break

			else:
				target_ip = input("IP is not valid. Please re-enter the IP : ")

		while True:
			y = input("\t==> Press space key to continue...")
			if (y==" "):
				break
			else:
				continue

	elif (x=='2'):
		print("\n\n\t======== Reset Target IP address ======== \n")
		target_ip = input("\t==> Please enter the target IP address : ")

		while True:
			if re.fullmatch("[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}", str(target_ip)):
				break

			else:
				target_ip = input("IP is not valid. Please re-enter the IP : ")

		print("\n\n\t========================================= \n")

		while True:
			y = input("\t==> Press space key to continue...")
			if (y==" "):
				break
			else:
				continue

	elif (x=='3'):
		

		print("\n\n\t======== Port Scanning ======== \n")

		try:	
			string_ip = str(target_ip)
		except:
			target_ip = input("\t==> Please enter the target IP address : ")

			while True:
				if re.fullmatch("[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}", str(target_ip)):
					break

				else:
					target_ip = input("IP is not valid. Please re-enter the IP : ")

			print("\n\n\t========================================= \n")


		print("\t Like : nmap -sSV -A -p- -T5 {}\n\n".format(target_ip))
		query1 = 'nmap -sSV -A -p- -T5 '+target_ip
		os.system(query1)
		print("\n\n\t=============================== \n")
		
		while True:
			y = input("\t==> Press space key to continue...")
			if (y==" "):
				break
			else:
				continue

	elif (x=='4'):
		
		print("\n\n\t======== Only Vuln Scan ======== \n")

		try:	
			string_ip = str(target_ip)
		except:
			target_ip = input("\t==> Please enter the target IP address : ")

			while True:
				if re.fullmatch("[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}", str(target_ip)):
					break

				else:
					target_ip = input("IP is not valid. Please re-enter the IP : ")

			print("\n\n\t========================================= \n")

		print("\t Like : nmap --script vuln {}\n\n".format(target_ip))
		query2 = 'nmap --script vuln '+ target_ip
		os.system(query2)
		print("\n\n\t================================ \n")
		
		while True:
			y = input("\t==> Press space key to continue...")
			if (y==" "):
				break
			else:
				continue

	elif (x=='5'):
		print("\n\n\t======== URL enum ========\n")
		# Converting IP address to string format
		try:	
			string_ip = str(target_ip)
		except:
			target_ip = input("\t==> Please enter the target IP address : ")

			while True:
				if re.fullmatch("[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}", str(target_ip)):
					break

				else:
					target_ip = input("IP is not valid. Please re-enter the IP : ")

			print("\n\n\t========================================= \n")

		#removing endling new line character
		#string_ip = string_ip[:-1]

		while True:
			#This output will change accordingly to the IP. It is dynamic banner.
			output_banner = 'dirb "http://' + string_ip + '" /usr/share/dirb/wordlists/big.txt -X .php -o result5.txt\n\n'
			print(output_banner)
			
			#I have given user defined query, as it may require customization for enumerations
			print("\tNOTE: Output file is necessary for further processing")
			query5 = input("\t==> Please enter the query : ")
			
			#Executing the dirb query
			os.system(query5)

			val_1 = input("\t==> Run DIRB again? (y/n) : ")

			if str(val_1) == 'n':
				break
			else:
				continue

		response5 = input("\t==> Would you like to check LFI vulnerability (y/n)")
		
		if(response5 == 'y' or response5 == 'Y'):
			
			#get output of dirb query in result5.txt
			file5 = open("result5.txt", "r")
			our_urls = []

			#getting the relevant information from result5.txt
			for line in file5:
				if re.match(r"\+", line):
					temp = line.split(" ")
					our_urls.append(temp[1])

			#some necessary housekeeping
			file5.close()
			os.system("rm result5.txt")

			response5 = input("\t==> Would you like to use default LFI fuzzing list location (y/n)")

			if response5 == 'y':
				try:
					fuzz_file = open("LFI_fuzz_list.txt","r")

				except:
					print("File LFI_fuzz_list.txt not found in current directory.")
			else:
				LFI_list_path = input("\t==> Please enter path of LFI fuzzing list with qoutations(\"\"): ")
				fuzz_file = open(LFI_list_path,"r")

			target_array = []
			final_array = []

			for fuzzes in fuzz_file:
				for urls in our_urls:
					target_array.append(str(urls) + str(fuzzes))
			
			# for line in target_array:
			# 	print line

			fuzz_file.close()

			#check target array for requests 200 code
			for target_url in target_array:
				res = requests.get(target_url)
				res_content = str(res.content)

				if re.search("([\w\!\/]*\:){6}", res_content):
						final_array.append(target_url)	


			print("\n\n\t==> These are the below urls vulnerable to LFI attacks\n")
			for line in final_array:
				print("\t[+]. {}\n".format(line))


		print("\n\n\t========================== \n")

		while True:
			print("\t==> Press space key to continue...")
			y = input()
			if (y==" "):
				break
			else:
				continue

	elif (x=='6'):
		print("\n\n\t======== Useful Commands ========\n")
		print("\t sudo -l\n")
		print("\t ls -talhr \t (tall hr)\n")
		print("\n\n\t=================================\n")
		
		while True:
			print("\t==> Press space key to continue...")
			y = input()
			if (y==" "):
				break
			else:
				continue

	elif (x=='7'):
		break

	else:
		continue
